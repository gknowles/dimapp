<!DOCTYPE html>
<!--
Copyright Glen Knowles 2022.
Distributed under the Boost Software License, Version 1.0.

network-routes.html - dim webapp
-->
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1,
    shrink-to-fit=no"/>
<script src="initialize.js"></script>
<script src="network-common.js"></script>
<script src="/srv/network/routes.json?jsVar=srvdata"></script>
<script>
addOpts({
  computed: {
    sortedRoutes() {
      const pageSize = 25
      // Returns array of 'pages' where each page is an array of up to pageSize
      // objects.
      let arr = this.routes;
      arr.sort((a, b) => {
        if (a.path != b.path)
          return (a.path < b.path) ? -1 : 1
        return 0
      })
      return makePages(arr, pageSize)
    },
  },
})
</script>
</head>
<body>
<div id="app" style="visibility: hidden">
  <script>networkIntro('Routes')</script>

  <div class="container-fluid mt-2">
    <div class="row gx-3">
      <template v-for="page in sortedRoutes">
        <div class="col-auto">
          <table>
            <tr>
              <th rowspan="2" onclick="tableSort(this)">Path</th>
              <th rowspan="2" onclick="tableSort(this)">Methods</th>
              <th colspan="2">Matched</th>
              <th rowspan="2" onclick="tableSort(this)">Name</th>
              <th rowspan="2" onclick="tableSort(this)">Desc</th>
              <th rowspan="2" onclick="tableSort(this)">Render</th>
            </tr>
            <tr>
              <th onclick="tableSort(this)">Count</th>
              <th onclick="tableSort(this)">Age</th>
            </tr>
            <template v-for="val in page">
              <tr :class="ageClass(val.lastMatched)">
                <td>
                  <a v-if="val.methods.includes('GET')"
                      :href="val.renderPath ? val.renderPath : val.path">
                    {{val.path}}{{val.recurse ? '...' : ''}}
                  </a>
                  <template v-else>
                    {{val.path}}{{val.recurse ? '...' : ''}}
                  </template>
                </td>
                <td>
                  <template v-for="(name, index) in val.methods">
                    <template v-if="index > 0">, </template>
                    {{name}}
                  </template>
                </td>
                <td class="text-end">{{val.matched.toLocaleString()}}</td>
                <td class="text-center">{{readableAge(val.lastMatched)}}</td>
                <td>{{val.name}}</td>
                <td>{{val.desc}}</td>
                <td>{{val.renderPath}}</td>
              </tr>
            </template>
          </table>
        </div>
      </template>
    </div>
    <table>
      <tr class='disabled'><td>Has never matched</td></tr>
      <tr><td>Has matched within the last hour</td></tr>
      <tr class='recent'><td>Has matched within 24 hours</td></tr>
      <tr class='old'><td>More than 24 hours since last match</td></tr>
    </table>
  </div>
</div>

<script>finalize()</script>
</body>
</html>
